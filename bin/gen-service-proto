#! /usr/bin/env python

import sys

def error(msg):
    print '!! ERROR: %s' % msg
    sys.exit(1)

args = sys.argv[1:]
if not args:
    print 'Usage: gen-service-proto [METHODS ...]'
    sys.exit()

messages = []
methods = []

for method in args:
    method = method.strip()
    if not method:
        continue
    if method[0] == method[0].upper():
        error('The method name %r must start with a lowercase character' % method)
    if not method[0].isalpha():
        error('The method name %r must start with a character in the range a-z' % method)
    msg = method[0].upper() + method[1:]
    messages.append(msg + 'Request')
    messages.append(msg + 'Response')
    methods.append([method, msg])

descriptor = [
    'syntax = "proto3";',
    '',
    'service api {'
]

for (method, msg) in sorted(methods):
    descriptor.append(
        '   rpc %s(%sRequest) returns (%sResponse);' % (method, msg, msg)
    )

descriptor.append('}')
descriptor.append('')

for idx, msg in enumerate(sorted(messages)):
    descriptor.append('message %s {' % msg)
    descriptor.append('}')
    descriptor.append('')

print '\n'.join(descriptor)
