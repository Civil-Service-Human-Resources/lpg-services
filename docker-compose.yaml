version: "3.4"
services:

# ElasticSearch
  kibana:
    container_name: kibana
    image: docker.elastic.co/kibana/kibana@sha256:0d2565286641d213fdbc26ffe29c33268d31e4820ea7af636ebc7d879d736895
    ports:
      - 5601:5601
    depends_on:
      - elasticsearch

  elasticsearch:
    container_name: elasticsearch
    image: docker.elastic.co/elasticsearch/elasticsearch@sha256:5b2bb3e91379f04a9da7c477314a24b2428fb1a4c20696991dff54b70d1b4ef3
    ports:
      - 9200:9200
      - 9300:9300
    command: "elasticsearch -E cluster.name=local -E discovery.type=single-node"
# /ElasticSearch

# Learning Locker
  learning-locker-api-server:
    container_name: learning-locker-api-server
    depends_on:
      - mongodb
      - redis
      - mailhog
    image: cshr/lpg-learning-locker-api-server:988cb07eb553b13d90ea7a48d9da247ca74c74b8b3a0e5e91f837976b2a0fb3b
    ports:
      - 8082:8082

  learning-locker-api-worker:
    container_name: learning-locker-api-worker
    depends_on:
      - learning-locker-api-server
    image: cshr/lpg-learning-locker-api-worker:cd954f2c7cf423ce3c20223e4e3e73899246b96f9efdecc84770ac6b77d0ffe1

  learning-locker-ui:
    container_name: learning-locker-ui
    image: cshr/lpg-learning-locker-ui:b5cddb229c58e961b96b4566e99e8971ac2b56ee31189f14e7b510b029be89ee
    ports:
      - 3000:3000
    depends_on:
      - learning-locker-api-server

  learning-locker-xapi:
    container_name: learning-locker-xapi
    depends_on:
      - mongodb
      - redis
      - learning-locker-api-worker
    image: cshr/lpg-learning-locker-xapi:7e6b19d6d8bf99ce9d4c322b449a6744b7a33c23071e653bef827d0277b83441
    ports:
      - 8083:8083

  mailhog:
    container_name: mailhog-locker-api-worker
    image: mailhog/mailhog@sha256:5be1ae7cf894b58fffbe48f84a0541a3595e53124d460d3fb71b3450a8d11189
    ports:
      - 8025:8025

  mongodb:
    container_name: mongodb
    image: mongo@sha256:fbb95eaa5a0c84d0d2098775f166003c568a79f993d91309cee7cda4135bbbfd

  redis:
    container_name: redis
    image: redis@sha256:3446883dfe13ab3db67433aace0e72d8cd669c528e60c617c42d6c697f0fa41f

  setup-learning-locker:
    depends_on:
      - mailhog
      - mongodb
    environment:
      - NODE_PATH=/opt/learning-locker/setup
    image: cshr/lpg-learning-locker-setup:fc53b8729e706154b33f384081e0f3664d7ad9e7d8a3e9ddb3fd21e9dd10e556
# /Learning Locker

# CSHR

  learner-record:
    container_name: learner-record
    environment:
      AUTH_USER: user
      AUTH_PASSWORD: password
      XAPI_USERNAME: 66f2b4fc001e3da992d23b57d8a7457655bea078
      XAPI_PASSWORD: 1c0e1b6827606d7efed71e204939d048f94f842b
      XAPI_URL: http://learning-locker-xapi:8083/data/xAPI
    image: cshr/lpg-learner-record:dc31695e7d0f68725105cbc82f07d51b22777b9e
    depends_on:
      - learning-locker-xapi
    ports:
      - 9000:9000

  learning-catalogue:
    container_name: learning-catalogue
    command: ["./wait-for-it.sh", "elasticsearch:9300", "-t", "200", "--", "java", "-jar", "/data/app.jar"]
    depends_on:
      - elasticsearch
    environment:
      AUTH_USER: user
      AUTH_PASSWORD: password
      ELASTICSEARCH_CLUSTER: local
      ELASTICSEARCH_HOST: elasticsearch
      ELASTICSEARCH_PORT: 9300
    image: cshr/lpg-learning-catalogue:7d48424205c1eedd061f3bd267ac0f412f8cba1b
    ports:
      - 9001:9001

# /CSHR